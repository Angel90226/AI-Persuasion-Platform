"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdateruby_openai"]("main",{

/***/ "./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-auto-import!./node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./frontend_app/pages/FollowUp.vue?vue&type=script&setup=true&lang=js":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-auto-import!./node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./frontend_app/pages/FollowUp.vue?vue&type=script&setup=true&lang=js ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var vue__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! vue */ \"./node_modules/vue/dist/vue.runtime.esm-bundler.js\");\n/* harmony import */ var vue_router__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! vue-router */ \"./node_modules/vue-router/dist/vue-router.mjs\");\n/* harmony import */ var element_plus__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! element-plus */ \"./node_modules/element-plus/es/components/message/index.mjs\");\n/* harmony import */ var _static_canon_jpg__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../static/canon.jpg */ \"./frontend_app/static/canon.jpg\");\n/* harmony import */ var _static_hp_jpg__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../static/hp.jpg */ \"./frontend_app/static/hp.jpg\");\n/* harmony import */ var _constant_Constants_vue__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../constant/Constants.vue */ \"./frontend_app/constant/Constants.vue\");\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! axios */ \"./node_modules/axios/lib/axios.js\");\n/* unplugin-vue-components disabled */\n\n\n\n\n\n\n\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({\n  __name: 'FollowUp',\n  setup(__props, { expose: __expose }) {\n  __expose();\n\nconst route = (0,vue_router__WEBPACK_IMPORTED_MODULE_4__.useRoute)()\nconst router = (0,vue_router__WEBPACK_IMPORTED_MODULE_4__.useRouter)()\n\nconst phase = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)('followup')\nconst selectedPrinter = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)(null)\nconst showTyping = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)(true)\nconst currentStep = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)(0)\nconst firstSelection = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)(null)\nconst firstSelectionTime = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)(null)\nconst userCondition = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)(null)\nconst messageSegments = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)([])\nconst segmentTimestamps = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)([])\nconst printers = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)([])\nconst user_id = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)('anonymous')\nconst showRedirectDialog = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)(false)\n\n;(0,vue__WEBPACK_IMPORTED_MODULE_0__.onMounted)(() => {\n  window.scrollTo(0, 0)\n  checkFirstSelection()\n  getUserCondition()\n  getOrderedPrinters()\n  initMessageSegments()\n  setTimeout(() => {\n    setupInitialMessages()\n  }, 1200)\n})\n\nconst checkFirstSelection = () => {\n  user_id.value = route.query[_constant_Constants_vue__WEBPACK_IMPORTED_MODULE_3__[\"default\"].URL_USER_PARAMS] || 'anonymous';\n  if (user_id.value === 'anonymous') {\n    router.push({ path: '/missing', query: route.query })\n  }\n  else {\n    const localData = localStorage.getItem(user_id.value)\n    if (localData) {\n      const parsed = JSON.parse(localData)\n      if (parsed.firstSelection === 'hp' || parsed.firstSelection === 'canon') {\n        firstSelection.value = parsed.firstSelection\n        firstSelectionTime.value = parsed.firstSelectionTime\n      }\n    }\n    if (firstSelection.value !== 'hp' && firstSelection.value !== 'canon') {\n      router.push({ path: '/', query: route.query })\n    }\n  }\n}\n  \nconst getUserCondition = () => {\n  if (user_id.value !== 'anonymous') {\n    const localData = localStorage.getItem(user_id.value)\n    if (localData) {\n      const parsedData = JSON.parse(localData)\n      userCondition.value = parsedData.condition\n    }\n  }\n}\n\nconst getOrderedPrinters = () => {\n  printers.value = [..._constant_Constants_vue__WEBPACK_IMPORTED_MODULE_3__[\"default\"].PRINTERS];\n  const localData = JSON.parse(localStorage.getItem(user_id.value)) || {};\n  if (localData.printerOrder) {\n    const order = localData.printerOrder.split(',');\n    printers.value.sort((a, b) => order.indexOf(a.id) - order.indexOf(b.id));\n  }\n  // 替換圖片來源\n  printers.value = printers.value.map(printer => ({\n    ...printer,\n    image: printer.id === 'canon' ? _static_canon_jpg__WEBPACK_IMPORTED_MODULE_1__ : _static_hp_jpg__WEBPACK_IMPORTED_MODULE_2__\n  }));\n}\n\nconst initMessageSegments = () => {\n  // 取得 high presence 狀態\n  const isHigh = userCondition.value && userCondition.value.presence_condition === 'high';\n  // 依 user 選擇決定品牌\n  let selectedPrinter = '';\n\n  // 準備主訊息陣列\n  let segments = [];\n  if (firstSelection.value === 'hp') {\n    selectedPrinter = 'HP';\n    segments = [\n      'The Canon PIXMA TR7820 offers more advanced features and greater flexibility. ',\n      'The Canon PIXMA TR7820 prints in both black-and-white and color at competitive speeds—15 ppm and 10 ppm respectively—and includes a 2.7” LCD touchscreen for intuitive control. ',\n      'Users describe it as easy to set up and consistently reliable, with vivid color output and sharp text, especially when presentation matters. ',\n      'While color printing may not be the fastest, the Canon’s hybrid ink and streamlined design offer a smoother, more satisfying user experience.'\n    ];\n  } else {\n    selectedPrinter = 'Canon';\n    segments = [\n      'The HP OfficeJet Pro 8025e may be more cost-effective and feature-integrated. ',\n      'HP OfficeJet Pro 8025e leads in print speed—20 ppm for black-and-white—and supports a larger 225-sheet paper tray and legal-size printing (up to 8.5” x 14”), helping reduce workflow interruptions. ',\n      'Features like Smart Tasks and self-healing Wi-Fi give it a thoughtful edge, making repetitive tasks feel smoother and more automated. ',\n      'Although setup can take a bit longer, users praise its performance and depth of features, making HP a reliable partner.'\n    ];\n  }\n\n  // 如果是 high presence，最前面插入一句\n  if (isHigh && selectedPrinter) {\n    segments.unshift(`I see you have selected the ${selectedPrinter} printer.`);\n  }\n  console.log('isHigh:', isHigh)\n  console.log('firstSelection:', firstSelection.value)\n  console.log('selectedPrinter:', selectedPrinter)\n  console.log('segments:', segments)\n  messageSegments.value = segments;\n  segmentTimestamps.value = [];\n}\n\nconst isHighSocialPresence = (0,vue__WEBPACK_IMPORTED_MODULE_0__.computed)(() => {\n  return userCondition.value && userCondition.value.presence_condition === 'high'\n})\n\nconst setupInitialMessages = () => {\n  showTyping.value = false;\n  // 先顯示第一則訊息並記錄時間\n  currentStep.value = 1;\n  segmentTimestamps.value = [\n    new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })\n  ];\n  revealNextSegment();\n};\n\nconst revealNextSegment = () => {\n  if (currentStep.value < messageSegments.value.length) {\n    segmentTimestamps.value.push(\n      new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })\n    );\n    setTimeout(() => {\n      currentStep.value++;\n      revealNextSegment();\n    }, 1400);\n  }\n}\n\nconst scrollToBottom = () => {\n  ;(0,vue__WEBPACK_IMPORTED_MODULE_0__.nextTick)(() => {\n    const chatMessages = document.querySelector('.chat-messages');\n    if (chatMessages) {\n      chatMessages.scrollTop = chatMessages.scrollHeight;\n    }\n  });\n}\n\nconst selectPrinter = (id) => {\n  selectedPrinter.value = id\n}\n\nconst submitFinalSelection = async () => {\n  const api_url = `/submit-final-selection?user_id=${user_id.value}`;\n  const { data } = await axios__WEBPACK_IMPORTED_MODULE_5__[\"default\"].post(api_url, {\n    finalSelection: selectedPrinter.value,\n    finalSelectionTime: new Date().toISOString()\n  })\n\n  console.log('Submit Final Selection:', data)\n  taskFinished()\n}\n\nconst taskFinished = async () => {\n  const api_url = `/task-finished?user_id=${user_id.value}`;\n  const { data } = await axios__WEBPACK_IMPORTED_MODULE_5__[\"default\"].get(api_url, {\n    params: {\n      conditions: JSON.parse(localStorage.getItem(user_id.value)).condition\n    }\n  })\n  if (data.taskFinished) {\n    showRedirectDialog.value = true\n  }\n}\n\nconst goToSurvey = () => {\n  showRedirectDialog.value = false\n  router.push({ path: '/survey', query: route.query })\n}\n\n;(0,vue__WEBPACK_IMPORTED_MODULE_0__.watch)(currentStep, () => {\n  scrollToBottom()\n})\n\nconst __returned__ = { route, router, phase, selectedPrinter, showTyping, currentStep, firstSelection, firstSelectionTime, userCondition, messageSegments, segmentTimestamps, printers, user_id, showRedirectDialog, checkFirstSelection, getUserCondition, getOrderedPrinters, initMessageSegments, isHighSocialPresence, setupInitialMessages, revealNextSegment, scrollToBottom, selectPrinter, submitFinalSelection, taskFinished, goToSurvey, ref: vue__WEBPACK_IMPORTED_MODULE_0__.ref, computed: vue__WEBPACK_IMPORTED_MODULE_0__.computed, onMounted: vue__WEBPACK_IMPORTED_MODULE_0__.onMounted, nextTick: vue__WEBPACK_IMPORTED_MODULE_0__.nextTick, watch: vue__WEBPACK_IMPORTED_MODULE_0__.watch, get useRoute() { return vue_router__WEBPACK_IMPORTED_MODULE_4__.useRoute }, get useRouter() { return vue_router__WEBPACK_IMPORTED_MODULE_4__.useRouter }, get ElMessage() { return element_plus__WEBPACK_IMPORTED_MODULE_6__.ElMessage }, get canonImg() { return _static_canon_jpg__WEBPACK_IMPORTED_MODULE_1__ }, get hpImg() { return _static_hp_jpg__WEBPACK_IMPORTED_MODULE_2__ }, Constants: _constant_Constants_vue__WEBPACK_IMPORTED_MODULE_3__[\"default\"], get axios() { return axios__WEBPACK_IMPORTED_MODULE_5__[\"default\"] } }\nObject.defineProperty(__returned__, '__isScriptSetup', { enumerable: false, value: true })\nreturn __returned__\n}\n\n});\n\n//# sourceURL=webpack://ruby-openai/./frontend_app/pages/FollowUp.vue?./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-vue-components!./node_modules/unplugin/dist/webpack/loaders/transform.js?unpluginName=unplugin-auto-import!./node_modules/vue-loader/dist/index.js??ruleSet%5B1%5D.rules%5B6%5D.use%5B0%5D");

/***/ })

},
/******/ function(__webpack_require__) { // webpackRuntimeModules
/******/ /* webpack/runtime/getFullHash */
/******/ (() => {
/******/ 	__webpack_require__.h = () => ("89a390bfe4fe3f3f4ecb")
/******/ })();
/******/ 
/******/ }
);